# Nginx 配置文件 - 打印代理管理后台
# 路径: /etc/nginx/sites-available/pa.easyify.uk
# 域名: pa.easyify.uk

# HTTPS 配置 - pa.easyify.uk
server {
    listen 443 ssl;
    server_name pa.easyify.uk;
    
    # SSL 证书
    ssl_certificate /etc/letsencrypt/live/pa.easyify.uk/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/pa.easyify.uk/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
    # 日志
    access_log /var/log/nginx/pa-access.log;
    error_log /var/log/nginx/pa-error.log;
    
    # HTTP API 代理
    location / {
        proxy_pass http://127.0.0.1:3004;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_http_version 1.1;
        proxy_read_timeout 60s;
        proxy_send_timeout 60s;
        proxy_connect_timeout 60s;
    }
}

# HTTP 重定向到 HTTPS - pa.easyify.uk
server {
    listen 80;
    server_name pa.easyify.uk;
    return 301 https://$server_name$request_uri;
}

# 明确拒绝 www.easyify.uk 访问 pa.easyify.uk 服务
server {
    listen 443 ssl;
    server_name www.easyify.uk;
    
    # 使用 pa.easyify.uk 的证书（如果证书包含 www.easyify.uk）
    ssl_certificate /etc/letsencrypt/live/pa.easyify.uk/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/pa.easyify.uk/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
    # 返回 444 (关闭连接)
    return 444;
}

# HTTP - 拒绝 www.easyify.uk
server {
    listen 80;
    server_name www.easyify.uk;
    return 444;
}
