# ğŸš€ å¼€æœºè‡ªå¯åŠ¨é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨ Windows WSL ç¯å¢ƒä¸­é…ç½®æ‰“å°ä»£ç†æœåŠ¡çš„å¼€æœºè‡ªå¯åŠ¨ã€‚

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PM2 + systemdï¼ˆæ¨èï¼ŒWSL2ï¼‰

å¦‚æœæ‚¨çš„ WSL æ”¯æŒ systemdï¼ˆWSL2 é»˜è®¤æ”¯æŒï¼‰ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ã€‚

### è‡ªåŠ¨é…ç½®ï¼ˆéƒ¨ç½²è„šæœ¬å·²åŒ…å«ï¼‰

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å°è¯•é…ç½® PM2 startupã€‚å¦‚æœæ£€æµ‹åˆ° systemdï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```bash
sudo env "PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$HOME/.npm-global/bin:$PATH" $(command -v pm2) startup systemd -u $USER --hp $HOME
pm2 save
```

è‹¥è‡ªåŠ¨é…ç½®å¤±è´¥ï¼Œè„šæœ¬ä¼šç»™å‡ºå®Œæ•´çš„æ‰‹åŠ¨å‘½ä»¤ã€‚åªéœ€å¤åˆ¶ç²˜è´´å³å¯ã€‚

> â„¹ï¸ **æƒé™æç¤º**ï¼šéƒ¨ç½²è„šæœ¬ä¼šä¾æ¬¡å°è¯•ä¸‰ç§æ–¹å¼å®‰è£… PM2ï¼š
> 1. æ™®é€šæƒé™ `npm install -g pm2`
> 2. `sudo npm install -g pm2`
> 3. å°† npm å‰ç¼€åˆ‡æ¢åˆ° `~/.npm-global` å¹¶å®‰è£…
> 
> å¦‚æœä¸‰ç§æ–¹å¼éƒ½å¤±è´¥ï¼Œè„šæœ¬ä¼šç»ˆæ­¢å¹¶æç¤ºæ‰‹åŠ¨æ“ä½œã€‚æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…åé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬å³å¯ã€‚

### æ‰‹åŠ¨é…ç½®

1. **ç¡®ä¿æœåŠ¡å·²å¯åŠ¨å¹¶ä¿å­˜**
   ```bash
   cd ~/print-agent/agent
   pm2 start local-print-agent.js --name print-agent
   pm2 save
   ```

2. **é…ç½® systemd å¯åŠ¨**
   ```bash
   pm2 startup systemd -u $USER --hp $HOME
   ```
   
   è¿™ä¼šè¾“å‡ºä¸€ä¸ª `sudo` å‘½ä»¤ï¼Œå¤åˆ¶å¹¶è¿è¡Œå®ƒã€‚

3. **éªŒè¯é…ç½®**
   ```bash
   pm2 save
   ```

4. **æµ‹è¯•é‡å¯**
   ```bash
   # é‡å¯ WSL
   wsl.exe --shutdown
   # é‡æ–°æ‰“å¼€ WSLï¼Œæ£€æŸ¥æœåŠ¡æ˜¯å¦è‡ªåŠ¨å¯åŠ¨
   pm2 status
   ```

---

### æ–¹æ³•äºŒï¼šWindows Startup æ–‡ä»¶å¤¹ï¼ˆWSL1 æˆ–ä¸æ”¯æŒ systemdï¼‰

å¦‚æœæ‚¨çš„ WSL ä¸æ”¯æŒ systemdï¼Œéƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š

1. åˆ›å»º `~/print-agent/start-print-agent.sh`ï¼ˆWSL å¯åŠ¨è„šæœ¬ï¼‰
2. åœ¨ Windows Startup ç›®å½•ç”Ÿæˆ `print-agent-auto-start.cmd`
   - è·¯å¾„ç±»ä¼¼ï¼š`C:\Users\<ç”¨æˆ·å>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\print-agent-auto-start.cmd`
3. è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡è¯¥è„šæœ¬ï¼Œç«‹å³å”¤é†’ PM2

> âš ï¸ è‹¥è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œè„šæœ¬ä¼šè¾“å‡º Win+R å¯ç›´æ¥å¤åˆ¶çš„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
> `cmd /c "C:\Users\<ç”¨æˆ·å>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\print-agent-auto-start.cmd"`
> å¤åˆ¶åæ‰‹åŠ¨è¿è¡Œå³å¯ã€‚

### æ‰‹åŠ¨éªŒè¯/é‡æ–°æ‰§è¡Œ

- æŒ‰ `Win + R`
- ç²˜è´´éƒ¨ç½²è„šæœ¬è¾“å‡ºçš„å‘½ä»¤ï¼ˆå¦‚ä¸Šï¼‰
- æŒ‰ Enterï¼Œå¯æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å¯åŠ¨è„šæœ¬

è¯¥ cmd æ–‡ä»¶ä½äº Startup ç›®å½•ï¼ŒWindows ç™»å½•åä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€é¢å¤–é…ç½®ä»»åŠ¡è®¡åˆ’ç¨‹åºã€‚

---

## éªŒè¯è‡ªå¯åŠ¨é…ç½®

### æ£€æŸ¥ PM2 æœåŠ¡çŠ¶æ€

```bash
pm2 status
```

åº”è¯¥çœ‹åˆ° `print-agent` æœåŠ¡æ­£åœ¨è¿è¡Œã€‚

### æ£€æŸ¥æœåŠ¡æ—¥å¿—

```bash
pm2 logs print-agent
```

### æµ‹è¯•é‡å¯

1. **é‡å¯ WSL**ï¼ˆæµ‹è¯• systemd æ–¹å¼ï¼‰
   ```bash
   wsl.exe --shutdown
   # é‡æ–°æ‰“å¼€ WSL
   pm2 status
   ```

2. **é‡å¯ Windows**ï¼ˆæµ‹è¯• Startup æ–¹å¼ï¼‰
   - é‡å¯ Windows
   - æ‰“å¼€ WSL
   - è¿è¡Œ `pm2 status` æ£€æŸ¥æœåŠ¡

---

## å¸¸è§é—®é¢˜

### Q: PM2 startup å‘½ä»¤å¤±è´¥

**A:** å¯èƒ½çš„åŸå› ï¼š
1. WSL ä¸æ”¯æŒ systemdï¼ˆWSL1ï¼‰
2. éœ€è¦ä½¿ç”¨ sudo æƒé™

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆæ–¹æ³•äºŒï¼‰
- æˆ–è€…å‡çº§åˆ° WSL2

### Q: æœåŠ¡å¯åŠ¨åç«‹å³é€€å‡º

**A:** æ£€æŸ¥æ—¥å¿—ï¼š
```bash
pm2 logs print-agent --lines 50
```

å¯èƒ½çš„åŸå› ï¼š
1. é…ç½®æ–‡ä»¶é”™è¯¯
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. Node.js ç‰ˆæœ¬ä¸å…¼å®¹

### Q: å¦‚ä½•ç¦ç”¨è‡ªå¯åŠ¨ï¼Ÿ

**A:** 

**PM2 + systemdï¼š**
```bash
pm2 unstartup systemd
```

**Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼š**
1. æ‰“å¼€ä»»åŠ¡è®¡åˆ’ç¨‹åº
2. æ‰¾åˆ°"æ‰“å°ä»£ç†æœåŠ¡"ä»»åŠ¡
3. å³é”® â†’ ç¦ç”¨

### Q: å®‰è£… PM2 æ—¶å‡ºç° `EACCES` / `permission denied`

**A:**
1. éƒ¨ç½²è„šæœ¬å·²ç»è‡ªåŠ¨å°è¯•æ™®é€šå®‰è£…ã€sudo å®‰è£…ä»¥åŠç”¨æˆ·ç›®å½•å®‰è£…
2. å¦‚æœä»ç„¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œï¼š
   ```bash
   sudo npm install -g pm2
   ```
3. å¦‚æœæ²¡æœ‰ `sudo`ï¼Œå¯ä»¥æ”¹ä¸ºå®‰è£…åˆ°ç”¨æˆ·ç›®å½•ï¼ˆè„šæœ¬ä¹Ÿä¼šå°è¯•ï¼Œä½†å¯æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼‰ï¼š
   ```bash
   mkdir -p ~/.npm-global
   npm config set prefix ~/.npm-global
   export PATH=$HOME/.npm-global/bin:$PATH
   echo 'export PATH=$HOME/.npm-global/bin:$PATH' >> ~/.bashrc
   npm install -g pm2
   ```
   ç„¶åé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬ã€‚

---

## æ¨èé…ç½®

- **WSL2 ç”¨æˆ·**ï¼šä½¿ç”¨æ–¹æ³•ä¸€ï¼ˆPM2 + systemdï¼‰
- **WSL1 ç”¨æˆ·**ï¼šä½¿ç”¨æ–¹æ³•äºŒï¼ˆWindows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼‰
- **éœ€è¦ç®€å•é…ç½®**ï¼šä½¿ç”¨æ–¹æ³•ä¸‰ï¼ˆå¯åŠ¨è„šæœ¬ï¼‰

---

## ç›¸å…³å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs print-agent

# é‡å¯æœåŠ¡
pm2 restart print-agent

# åœæ­¢æœåŠ¡
pm2 stop print-agent

# åˆ é™¤æœåŠ¡
pm2 delete print-agent

# ä¿å­˜å½“å‰é…ç½®
pm2 save

# æ¢å¤ä¿å­˜çš„é…ç½®
pm2 resurrect
```

---

**æœ€åæ›´æ–°**ï¼š2025-11-07

