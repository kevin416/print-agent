# 打印机兼容性追踪（热敏 / 标签机）

> 目标：整理常见 USB 热敏 / 标签打印机的兼容性，指导驱动设置，并针对无法切换 WinUSB 的型号探索替代方案。

---

## 1. 常见型号测试矩阵

| 品牌 / 型号 | VID:PID | 默认驱动 | 是否需改成 WinUSB/libusbK | 大票 (80mm) | 小票 (58mm) | 标签模式 | 备注 / 测试人 |
| ----------- | ------- | -------- | ------------------------- | ----------- | ------------ | -------- | ------------- |
| Epson TM-T88V | `0x04B8:0x0E03` | Epson Advanced Printer Driver | ✅ | ☐ | ☑ | ☐ | 需在 Zadig 选择接口 `EPSON TM-T88` |
| Epson TM-T20II | `0x04B8:0x0E15` | Epson Advanced Printer Driver | ✅ | ☑ | ☐ | ☐ | |
| XP-80C (佳博/GPrinter) | `0x0483:0x5743` | Xprinter Driver | ✅ | ☑ | ☑ | ☐ | |
| Xprinter XP-58IIH | `0x0416:0x5011` | Xprinter Driver | ✅ | ☐ | ☑ | ☐ | |
| Rongta RP326 | `0x028F:0x0007` | Rongta | ✅ | ☑ | ☑ | ☐ | |
| TSC TE200 (标签) | `0x1203:0x0007` | TSC Driver | ✅ | ☐ | ☐ | ☑ | 需测试连续纸/标签模式切换 |
| Honeywell PC42t | `0x0C2E:0x0B61` | Honeywell Driver | ✅ | ☐ | ☐ | ☑ | |
| 其他 … | | | | | | | |

👉 **记录要求**：

1. `VID:PID` 可通过控制面板设备列表或 `usbManager` 日志获取。
2. `默认驱动` 指首次连接后系统使用的驱动名称。
3. 对每个尺寸模式进行一次测试打印，并在“备注”列记录是否存在换行、对齐等异常。
4. 完成测试后在 `README` 或后台，为该 `VID:PID` 预置别名，方便用户识别。

---

## 2. 驱动与替代方案

### 2.1 推荐驱动

- 首选 **WinUSB (v6.x)** / **libusbK**，以便 Node.js 直接写入 USB 端点。
- 若厂商提供 “**RAW USB**” 模式驱动也可尝试（原厂驱动直接暴露写入接口）。
- 修改驱动前建议备份原驱动安装包；恢复时在设备管理器中“更新驱动程序”→“浏览计算机上的驱动程序”指向原厂目录即可。

### 2.2 无法切换 WinUSB 的型号

部分打印机强制绑定自家驱动，或使用复合设备（Composite）导致 WinUSB 安装失败。当前探索方向：

1. **虚拟串口 / CDC 模式**：如果驱动提供虚拟串口，可通过串口写入 ESC/POS 数据（待实现串口输出模块）。
2. **系统打印队列桥接**：考虑在 Windows 使用原厂驱动，将打印任务（文本/图像）发送到系统打印队列。需要渲染成 RAW 数据并调用 `Print Spooler API`（待调研）。
3. **SDK / 命令行工具**：某些品牌提供 CLI/SDK，可调用其接口发送原始数据；需评估授权及跨平台可行性。

> TODO：
> - [ ] 收集具体无法切换 WinUSB 的型号列表、错误提示。
> - [ ] 验证虚拟串口输出方案，评估延迟和稳定性。
> - [ ] 原厂驱动桥接 PoC（优先 Windows）。

---

## 3. 采集工具与日志

- `src/main/usbManager.js` 每次刷新时会输出 `vendorId`/`productId`/`manufacturerName`，可直接从日志复制。
- 可考虑新增 CLI（例如 `npm run inspect-usb`）单独输出所有字段（`bInterfaceClass` / `portNumbers` 等），方便归档。
- 建议在 `printHistory` 或心跳上传中附带 `driverHint`（例如提示“检测到非 WinUSB 驱动”），减少门店排查成本。

---

## 4. 任务分配（建议）

| 项目 | 内容 | 优先级 | 负责人 | 状态 |
| ---- | ---- | ------ | ------ | ---- |
| 测试 Epson/GPrinter 等常见热敏机 | 填写矩阵、记录驱动步骤 | 高 |  | ☐ |
| 标签打印支持 | 测试 TSC/斑马等标签机，验证走纸、尺寸 | 高 |  | ☐ |
| 驱动检测提示 | 在 UI 中突出显示 “未使用 WinUSB” 的设备 | 中 |  | ☐ |
| 虚拟串口方案调研 | 选定一款仅支持 COM 的机型试点 | 中 |  | ☐ |
| 系统打印桥接 PoC | 调研 Windows Print Spooler Raw 写入 | 低 |  | ☐ |

---

如需添加新型号，请顺序执行：

1. 连接打印机 → 确认设备名称 → 获取 VID:PID。
2. 使用本地 Agent 的“测试打印”验证大票/小票/标签模式。
3. 在矩阵中填写，并根据成功情况更新“备注”。
4. 如遇驱动问题，在“驱动与替代方案”章节附加详细错误描述。

欢迎持续补充与完善！🚀

